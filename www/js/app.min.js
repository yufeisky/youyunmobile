!function(e,o){"function"==typeof define&&(define.amd||define.cmd)?define(function(){return o(e)}):o(e,!0)}(this,function(e,o){function t(o,t,n){e.WeixinJSBridge?WeixinJSBridge.invoke(o,r(t),function(e){s(o,e,n)}):l(o,n)}function n(o,t,n){e.WeixinJSBridge?WeixinJSBridge.on(o,function(e){n&&n.trigger&&n.trigger(e),s(o,e,t)}):n?l(o,n):l(o,t)}function r(e){return e=e||{},e.appId=I.appId,e.verifyAppId=I.appId,e.verifySignType="sha1",e.verifyTimestamp=I.timestamp+"",e.verifyNonceStr=I.nonceStr,e.verifySignature=I.signature,e}function i(e){return{timeStamp:e.timestamp+"",nonceStr:e.nonceStr,"package":e["package"],paySign:e.paySign,signType:e.signType||"SHA1"}}function s(e,o,t){var n,r,i;switch(delete o.err_code,delete o.err_desc,delete o.err_detail,n=o.errMsg,n||(n=o.err_msg,delete o.err_msg,n=a(e,n,t),o.errMsg=n),t=t||{},t._complete&&(t._complete(o),delete t._complete),n=o.errMsg||"",I.debug&&!t.isInnerInvoke&&alert(JSON.stringify(o)),r=n.indexOf(":"),i=n.substring(r+1)){case"ok":t.success&&t.success(o);break;case"cancel":t.cancel&&t.cancel(o);break;default:t.fail&&t.fail(o)}t.complete&&t.complete(o)}function a(e,o){var t,n,r,i;if(o){switch(t=o.indexOf(":"),e){case m.config:n="config";break;case m.openProductSpecificView:n="openProductSpecificView";break;default:n=o.substring(0,t),n=n.replace(/_/g," "),n=n.replace(/\b\w+\b/g,function(e){return e.substring(0,1).toUpperCase()+e.substring(1)}),n=n.substring(0,1).toLowerCase()+n.substring(1),n=n.replace(/ /g,""),-1!=n.indexOf("Wcpay")&&(n=n.replace("Wcpay","WCPay")),r=g[n],r&&(n=r)}i=o.substring(t+1),"confirm"==i&&(i="ok"),"failed"==i&&(i="fail"),-1!=i.indexOf("failed_")&&(i=i.substring(7)),-1!=i.indexOf("fail_")&&(i=i.substring(5)),i=i.replace(/_/g," "),i=i.toLowerCase(),("access denied"==i||"no permission to execute"==i)&&(i="permission denied"),"config"==n&&"function not exist"==i&&(i="ok"),o=n+":"+i}return o}function c(e){var o,t,n,r;if(e){for(o=0,t=e.length;t>o;++o)n=e[o],r=m[n],r&&(e[o]=r);return e}}function l(e,o){if(I.debug&&!o.isInnerInvoke){var t=g[e];t&&(e=t),o&&o._complete&&delete o._complete,console.log('"'+e+'",',o||"")}}function u(){if(!("6.0.2">T||$.systemType<0)){var e=new Image;$.appId=I.appId,$.initTime=C.initEndTime-C.initStartTime,$.preVerifyTime=C.preVerifyEndTime-C.preVerifyStartTime,_.getNetworkType({isInnerInvoke:!0,success:function(o){$.networkType=o.networkType;var t="https://open.weixin.qq.com/sdk/report?v="+$.version+"&o="+$.isPreVerifyOk+"&s="+$.systemType+"&c="+$.clientVersion+"&a="+$.appId+"&n="+$.networkType+"&i="+$.initTime+"&p="+$.preVerifyTime+"&u="+$.url;e.src=t}})}}function p(){return(new Date).getTime()}function d(o){y&&(e.WeixinJSBridge?o():h.addEventListener&&h.addEventListener("WeixinJSBridgeReady",o,!1))}function f(){_.invoke||(_.invoke=function(o,t,n){e.WeixinJSBridge&&WeixinJSBridge.invoke(o,r(t),n)},_.on=function(o,t){e.WeixinJSBridge&&WeixinJSBridge.on(o,t)})}var m,g,h,v,S,y,b,w,T,C,$,I,P,x,_;if(!e.jWeixin)return m={config:"preVerifyJSAPI",onMenuShareTimeline:"menu:share:timeline",onMenuShareAppMessage:"menu:share:appmessage",onMenuShareQQ:"menu:share:qq",onMenuShareWeibo:"menu:share:weiboApp",previewImage:"imagePreview",getLocation:"geoLocation",openProductSpecificView:"openProductViewWithPid",addCard:"batchAddCard",openCard:"batchViewCard",chooseWXPay:"getBrandWCPayRequest"},g=function(){var e,o={};for(e in m)o[m[e]]=e;return o}(),h=e.document,v=h.title,S=navigator.userAgent.toLowerCase(),y=-1!=S.indexOf("micromessenger"),b=-1!=S.indexOf("android"),w=-1!=S.indexOf("iphone")||-1!=S.indexOf("ipad"),T=function(){var e=S.match(/micromessenger\/(\d+\.\d+\.\d+)/)||S.match(/micromessenger\/(\d+\.\d+)/);return e?e[1]:""}(),C={initStartTime:p(),initEndTime:0,preVerifyStartTime:0,preVerifyEndTime:0},$={version:1,appId:"",initTime:0,preVerifyTime:0,networkType:"",isPreVerifyOk:1,systemType:w?1:b?2:-1,clientVersion:T,url:encodeURIComponent(location.href)},I={},P={_completes:[]},x={state:0,res:{}},d(function(){C.initEndTime=p()}),_={config:function(e){I=e,l("config",e),d(function(){t(m.config,{verifyJsApiList:c(I.jsApiList)},function(){P._complete=function(e){C.preVerifyEndTime=p(),x.state=1,x.res=e},P.success=function(){$.isPreVerifyOk=0},P.fail=function(e){P._fail?P._fail(e):x.state=-1};var e=P._completes;return e.push(function(){I.debug||u()}),P.complete=function(o){for(var t=0,n=e.length;n>t;++t)e[t](o);P._completes=[]},P}()),C.preVerifyStartTime=p()}),I.beta&&f()},ready:function(e){0!=x.state?e():(P._completes.push(e),!y&&I.debug&&e())},error:function(e){"6.0.2">T||(-1==x.state?e(x.res):P._fail=e)},checkJsApi:function(e){var o=function(e){var o,t,n=e.checkResult;for(o in n)t=g[o],t&&(n[t]=n[o],delete n[o]);return e};t("checkJsApi",{jsApiList:c(e.jsApiList)},function(){return e._complete=function(e){if(b){var t=e.checkResult;t&&(e.checkResult=JSON.parse(t))}e=o(e)},e}())},onMenuShareTimeline:function(e){n(m.onMenuShareTimeline,{complete:function(){t("shareTimeline",{title:e.title||v,desc:e.title||v,img_url:e.imgUrl,link:e.link||location.href},e)}},e)},onMenuShareAppMessage:function(e){n(m.onMenuShareAppMessage,{complete:function(){t("sendAppMessage",{title:e.title||v,desc:e.desc||"",link:e.link||location.href,img_url:e.imgUrl,type:e.type||"link",data_url:e.dataUrl||""},e)}},e)},onMenuShareQQ:function(e){n(m.onMenuShareQQ,{complete:function(){t("shareQQ",{title:e.title||v,desc:e.desc||"",img_url:e.imgUrl,link:e.link||location.href},e)}},e)},onMenuShareWeibo:function(e){n(m.onMenuShareWeibo,{complete:function(){t("shareWeiboApp",{title:e.title||v,desc:e.desc||"",img_url:e.imgUrl,link:e.link||location.href},e)}},e)},startRecord:function(e){t("startRecord",{},e)},stopRecord:function(e){t("stopRecord",{},e)},onVoiceRecordEnd:function(e){n("onVoiceRecordEnd",e)},playVoice:function(e){t("playVoice",{localId:e.localId},e)},pauseVoice:function(e){t("pauseVoice",{localId:e.localId},e)},stopVoice:function(e){t("stopVoice",{localId:e.localId},e)},onVoicePlayEnd:function(e){n("onVoicePlayEnd",e)},uploadVoice:function(e){t("uploadVoice",{localId:e.localId,isShowProgressTips:0==e.isShowProgressTips?0:1},e)},downloadVoice:function(e){t("downloadVoice",{serverId:e.serverId,isShowProgressTips:0==e.isShowProgressTips?0:1},e)},translateVoice:function(e){t("translateVoice",{localId:e.localId,isShowProgressTips:0==e.isShowProgressTips?0:1},e)},chooseImage:function(e){t("chooseImage",{scene:"1|2",count:e.count||9,sizeType:e.sizeType||["original","compressed"]},function(){return e._complete=function(e){if(b){var o=e.localIds;o&&(e.localIds=JSON.parse(o))}},e}())},previewImage:function(e){t(m.previewImage,{current:e.current,urls:e.urls},e)},uploadImage:function(e){t("uploadImage",{localId:e.localId,isShowProgressTips:0==e.isShowProgressTips?0:1},e)},downloadImage:function(e){t("downloadImage",{serverId:e.serverId,isShowProgressTips:0==e.isShowProgressTips?0:1},e)},getNetworkType:function(e){var o=function(e){var o,t,n,r=e.errMsg;if(e.errMsg="getNetworkType:ok",o=e.subtype,delete e.subtype,o)e.networkType=o;else switch(t=r.indexOf(":"),n=r.substring(t+1)){case"wifi":case"edge":case"wwan":e.networkType=n;break;default:e.errMsg="getNetworkType:fail"}return e};t("getNetworkType",{},function(){return e._complete=function(e){e=o(e)},e}())},openLocation:function(e){t("openLocation",{latitude:e.latitude,longitude:e.longitude,name:e.name||"",address:e.address||"",scale:e.scale||28,infoUrl:e.infoUrl||""},e)},getLocation:function(e){e=e||{},t(m.getLocation,{type:e.type||"wgs84"},function(){return e._complete=function(e){delete e.type},e}())},hideOptionMenu:function(e){t("hideOptionMenu",{},e)},showOptionMenu:function(e){t("showOptionMenu",{},e)},closeWindow:function(e){e=e||{},t("closeWindow",{immediate_close:e.immediateClose||0},e)},hideMenuItems:function(e){t("hideMenuItems",{menuList:e.menuList},e)},showMenuItems:function(e){t("showMenuItems",{menuList:e.menuList},e)},hideAllNonBaseMenuItem:function(e){t("hideAllNonBaseMenuItem",{},e)},showAllNonBaseMenuItem:function(e){t("showAllNonBaseMenuItem",{},e)},scanQRCode:function(e){e=e||{},t("scanQRCode",{needResult:e.needResult||0,scanType:e.scanType||["qrCode","barCode"]},function(){return e._complete=function(e){var o,t;w&&(o=e.resultStr,o&&(t=JSON.parse(o),e.resultStr=t&&t.scan_code&&t.scan_code.scan_result))},e}())},openProductSpecificView:function(e){t(m.openProductSpecificView,{pid:e.productId,view_type:e.viewType||0},e)},addCard:function(e){var o,n,r,i,s=e.cardList,a=[];for(o=0,n=s.length;n>o;++o)r=s[o],i={card_id:r.cardId,card_ext:r.cardExt},a.push(i);t(m.addCard,{card_list:a},function(){return e._complete=function(e){var o,t,n,r=e.card_list;if(r){for(r=JSON.parse(r),o=0,t=r.length;t>o;++o)n=r[o],n.cardId=n.card_id,n.cardExt=n.card_ext,n.isSuccess=!!n.is_succ,delete n.card_id,delete n.card_ext,delete n.is_succ;e.cardList=r,delete e.card_list}},e}())},chooseCard:function(e){t("chooseCard",{app_id:I.appId,location_id:e.shopId||"",sign_type:e.signType||"SHA1",card_id:e.cardId||"",card_type:e.cardType||"",card_sign:e.cardSign,time_stamp:e.timestamp+"",nonce_str:e.nonceStr},function(){return e._complete=function(e){e.cardList=e.choose_card_info,delete e.choose_card_info},e}())},openCard:function(e){var o,n,r,i,s=e.cardList,a=[];for(o=0,n=s.length;n>o;++o)r=s[o],i={card_id:r.cardId,code:r.code},a.push(i);t(m.openCard,{card_list:a},e)},chooseWXPay:function(e){t(m.chooseWXPay,i(e),e)}},o&&(e.wx=e.jWeixin=_),_}),angular.module("IonicClub",["ionic","IonicClub.router","IonicClub.controllers","IonicClub.services","IonicClub.filters","IonicClub.directives","IonicClub.pluginServices","ngCordova","LocalStorageModule","pasvaz.bindonce","angularMoment"]).run(["$ionicPlatform","$rootScope","$state","$timeout","$ionicHistory","$cordovaAppVersion","$ionicPopup","$ionicLoading","$cordovaFileTransfer","$cordovaFile","$cordovaFileOpener2","$cordovaProgress","ToastService","SplashscreenService","UmengService","amMoment",function(e,o,t,n,r,i,s,a,c,l,u,p,d,f,m,g){e.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),window.StatusBar&&StatusBar.styleDefault(),m.init(),f.hide(),g.changeLocale("zh-cn")}),e.registerBackButtonAction(function(e){return t.includes("tab.topics")?o.backButtonPressedOnceToExit?(window.plugins.umengAnalyticsPlugin.onKillProcess(),ionic.Platform.exitApp()):(o.backButtonPressedOnceToExit=!0,d.showShortTop("再按一次退出系统"),setTimeout(function(){o.backButtonPressedOnceToExit=!1},2e3)):t.includes("tab.account")||t.includes("tab.login")?t.go("tab.topics"):r.backView()?r.goBack():(o.backButtonPressedOnceToExit&&(window.plugins.umengAnalyticsPlugin.onKillProcess(),ionic.Platform.exitApp()),o.backButtonPressedOnceToExit=!0,d.showShortTop("再按一次退出系统"),setTimeout(function(){o.backButtonPressedOnceToExit=!1},2e3)),e.preventDefault(),!1},101)}]).config(["$ionicConfigProvider","localStorageServiceProvider",function(e,o){o.setPrefix("ZxjIonicClub"),e.tabs.style("standard"),e.tabs.position("bottom"),e.navBar.alignTitle("center"),e.backButton.icon("ion-ios-arrow-thin-left"),e.views.transition("no"),Date.prototype.format=function(e){var o={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var t in o)new RegExp("("+t+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?o[t]:("00"+o[t]).substr((""+o[t]).length)));return e}}]),angular.module("IonicClub.router",[]).config(["$provide","$stateProvider","$urlRouterProvider",function(e,o,t){o.state("tab",{url:"/tab","abstract":!0,templateUrl:"templates/tabs.html"}).state("tab.home",{url:"/home",views:{home:{templateUrl:"templates/home.html",controller:"homeCtrl"}},resolve:{validater:["$rootScope","WechatApi",function(e,o){console.log("重置微信分享"),e.upal_share={title:"悠云轻故事",desc:"我们期待你的加入",share_link:"http://www.upalapp.com/app/2016070401/index.html",imgUrl:"http://www.upalapp.com/app/2016070401/img/p01.png",currentUrl:location.href},o.f_wxReady()}]}}).state("tab.homeDetail",{url:"/homeDetail:storyObject",views:{home:{templateUrl:"templates/homeDetail.html",controller:"homeDetailCtrl"}}}).state("tab.star",{url:"/star",views:{star:{templateUrl:"templates/star.html",controller:"starCtrl"}}}).state("tab.user",{url:"/user",views:{user:{templateUrl:"templates/user.html",controller:"userCtrl"}}}),t.otherwise("tab/home")}]),angular.module("IonicClub.controllers",[]).controller("userCtrl",["$scope","$rootScope","$stateParams","$state","$ionicLoading","$ionicPopup","$ionicHistory","$ionicModal","$timeout","localStorageService","IonicService","TabService","Con",function(e,o,t,n,r,i,s,a,c,l,u,p,d){d.log("个人中心控制器已加载");var f={};e.storys=[],e.offLineStorys=[],e.collectStorys=[];var m=JSON.parse(l.get("User"));d.log(m),m?(e.more=!0,d.log("已登录"),f={userToken:m.token,userId:m.id},e.navs=[{title:"已上线",order:0,storyStatus:"1",pageNum:0},{title:"未上线",order:1,storyStatus:"0",pageNum:0},{title:"我的收藏",order:2,storyStatus:"3",pageNum:0},{title:"我的动态",order:3,storyStatus:"3",pageNum:0}],e.isActiveTab=function(o){return e.currentTab==o},e.doRefresh=function(t,n){e.more=!0;try{switch(e.currentTab=t,e.myActiveSlide=t,f.storyStatus=e.navs[t].storyStatus,e.navs[t].pageNum=1,f.pageNum=e.navs[t].pageNum,d.log(f.storyStatus),f.storyStatus){case"1":u.getStorys(f).then(function(t){"2"==t.messageType&&o.loginOut(),angular.equals(t.storys,[])&&(e.more=!1,e.$broadcast("scroll.infiniteScrollComplete")),t.storys&&(1==f.pageNum&&(e.storys=t.storys),e.$broadcast("scroll.infiniteScrollComplete"))})["finally"](function(){d.log("完成"),e.$broadcast("scroll.refreshComplete")});break;case"0":u.getStorys(f).then(function(t){"2"==t.messageType&&o.loginOut(),angular.equals(t.storys,[])&&(e.more=!1,e.$broadcast("scroll.refreshComplete")),t.storys&&(1==f.pageNum&&(e.offLineStorys=t.storys),e.$broadcast("scroll.refreshComplete"))})["finally"](function(){d.log("完成"),e.$broadcast("scroll.refreshComplete")});break;case"3":u.getCollectStorys(f).then(function(t){d.log(t),"2"==t.messageType&&o.loginOut(),angular.equals(t.storys,[])&&(e.more=!1,e.$broadcast("scroll.infiniteScrollComplete")),t.storys&&(1==f.pageNum&&(e.collectStorys=t.storys),e.$broadcast("scroll.refreshComplete"))})["finally"](function(){d.log("完成"),e.$broadcast("scroll.refreshComplete")});break;case"4":u.getCollectStorys(f).then(function(t){d.log(t),"2"==t.messageType&&o.loginOut(),angular.equals(t.storys,[])&&(e.more=!1,e.$broadcast("scroll.infiniteScrollComplete")),t.storys&&(1==f.pageNum&&(e.collectStorys=t.storys),e.$broadcast("scroll.refreshComplete"))})["finally"](function(){d.log("完成"),e.$broadcast("scroll.refreshComplete")})}}catch(r){}},e.loadMore=function(t,n){e.more=!0;try{switch(e.currentTab=t,e.myActiveSlide=t,f.storyStatus=e.navs[t].storyStatus,e.navs[t].pageNum=e.navs[t].pageNum+1,f.pageNum=e.navs[t].pageNum,d.log(f.storyStatus),f.storyStatus){case"1":u.getStorys(f).then(function(t){"2"==t.messageType&&o.loginOut(),angular.equals(t.storys,[])&&(e.more=!1,e.$broadcast("scroll.infiniteScrollComplete")),t.storys&&(1==f.pageNum?e.storys=t.storys:angular.forEach(t.storys,function(o){e.storys.push(o)}),e.$broadcast("scroll.infiniteScrollComplete"))});break;case"0":u.getStorys(f).then(function(t){d.log(t),"2"==t.messageType&&o.loginOut(),angular.equals(t.storys,[])&&(e.more=!1,e.$broadcast("scroll.infiniteScrollComplete")),t.storys&&(1==f.pageNum?e.offLineStorys=t.storys:angular.forEach(t.storys,function(o){e.offLineStorys.push(o)}),e.$broadcast("scroll.infiniteScrollComplete"))});break;case"3":u.getCollectStorys(f).then(function(t){d.log(t),"2"==t.messageType&&o.loginOut(),angular.equals(t.storys,[])&&(e.more=!1,e.$broadcast("scroll.infiniteScrollComplete")),t.storys&&(1==f.pageNum?e.collectStorys=t.storys:angular.forEach(t.storys,function(o){e.collectStorys.push(o)}),e.$broadcast("scroll.infiniteScrollComplete"))});break;case"4":d.log("我的动态")}}catch(r){e.more=!1}},e.myActiveSlide="0"):(d.log("未登录"),c(function(){o.changePage("tab.user")},100))}]).controller("homeDetailCtrl",["$scope","$rootScope","$sce","$stateParams","$ionicLoading","$ionicScrollDelegate","$ionicPopover","$ionicPopup","localStorageService","ShareService","IonicService","MsgBox","WechatApi","Con",function(e,o,t,n,r,i,s,a,c,l,u,p,d,f){f.log("首页详情"),e.urlParams=JSON.parse(n.storyObject),f.log(e.urlParams),e.urlParams.browse_count||(e.urlParams.browse_count=0),e.urlParams.share_count||(e.urlParams.share_count=0),e.urlParams.collection_count||(e.urlParams.collection_count=0),e.pubUrl=t.trustAsResourceUrl(e.urlParams.pub_url),e.collectFn=function(){var t=JSON.parse(c.get("User"));if(t){var n={userToken:t.token,userId:t.id,objectId:e.urlParams.story_id};u.postCollectStory(n).then(function(t){switch(f.log(t),t.messageType){case"1":e.closePopover(),p.showTexts("收藏成功"),e.urlParams.collection_count=t.storys[0].collection_count;break;case"2":c.remove("User"),o.openLoginModal();break;case"4":e.closePopover(),p.showTexts("该故事你已收藏过")}})["finally"](function(){e.$broadcast("scroll.refreshComplete")})}else o.openLoginModal()},e.showPopup=function(){e.closePopover(),e.data={};var o=a.show({templateUrl:"templates/Area/appSharePopup.html",scope:e,buttons:[{text:"<b>我知道了</b>",type:"button-positive",onTap:function(e){o.close(),jQuery(function(){setTimeout(function(){jQuery(".popup-container").removeClass("sharePopupContainer")},200)})}}]});jQuery(function(){jQuery(".popup-container").addClass("sharePopupContainer")})},o.shareStory=function(){u.postShareStory({objectId:e.urlParams.story_id}).then(function(o){switch(f.log(o),o.messageType){case"1":e.urlParams.share_count=o.storys[0].share_count}})},s.fromTemplateUrl("templates/Area/appShare.html",{scope:e}).then(function(o){e.popover=o}),e.openPopover=function(o){e.popover.show(o)},e.closePopover=function(){e.popover.hide()},o.upal_share={title:e.urlParams.story_title,desc:e.urlParams.second_title,share_link:e.urlParams.pub_url,imgUrl:e.urlParams.img_src,currentUrl:location.href},d.f_wxReady()}]).controller("homeCtrl",["$scope","$rootScope","$stateParams","$ionicLoading","$ionicScrollDelegate","localStorageService","ShareService","IonicService","Con",function(e,o,t,n,r,i,s,a,c){e.storys=[[],[],[],[]],e.more=!0,e.navs=[{title:"推荐",order:0,storyStatus:"3",pageNum:0},{title:"品牌故事",order:1,storyStatus:"1",pageNum:0},{title:"热点资讯",order:2,storyStatus:"2",pageNum:0},{title:"生活故事",order:3,storyStatus:"3",pageNum:0}],e.isActiveTab=function(o){return e.currentTab==o};var l=JSON.parse(i.get("User"));l?postParams={userToken:l.token,userId:l.id}:postParams={userToken:"",userId:""};var u=angular.element(window)[0].innerWidth;e.img_w=.45*u*.9+"px",e.doRefresh=function(o){e.more=!0,e.currentTab=o,e.myActiveSlide=o,postParams.storyType=e.navs[o].storyStatus,e.navs[o].pageNum=1,postParams.pageNum=e.navs[o].pageNum,a.getHomeStorys(postParams).then(function(o){angular.equals(o.storys,[])&&(e.more=!1,e.$broadcast("scroll.infiniteScrollComplete")),o.storys&&1==postParams.pageNum&&(e.storys[e.currentTab]=o.storys)})["finally"](function(){e.$broadcast("scroll.refreshComplete")})},e.loadMore=function(o,t){e.more=!0;try{e.currentTab=o,e.myActiveSlide=o,postParams.storyType=e.navs[o].storyStatus,e.navs[o].pageNum=e.navs[o].pageNum+1,postParams.pageNum=e.navs[o].pageNum,c.log(postParams.storyType),a.getHomeStorys(postParams).then(function(o){angular.equals(o.storys,[])&&(e.more=!1,e.$broadcast("scroll.infiniteScrollComplete")),o.storys&&(1==postParams.pageNum?e.storys[e.currentTab]=o.storys:angular.forEach(o.storys,function(o){e.storys[e.currentTab].push(o)}),e.$broadcast("scroll.infiniteScrollComplete"))})}catch(n){e.more=!1}},e.myActiveSlide="0"}]).controller("starCtrl",["$scope","$rootScope","$state","$stateParams","$ionicLoading","$ionicScrollDelegate","$ionicModal","$ionicHistory","$timeout","localStorageService","ShareService","IonicService","Con",function(e,o,t,n,r,i,s,a,c,l,u,p,d){var f=JSON.parse(l.get("User"));d.log(f),f||c(function(){o.changePage("tab.star")},100)}]).controller("loginCtrl",["$scope","$rootScope","$ionicPopup","$ionicHistory","$state","$cordovaBarcodeScanner","$ionicSlideBoxDelegate","$interval","$timeout","$ionicModal","localStorageService","AppVersionService","IonicService","MsgBox","Con",function(e,o,t,n,r,i,s,a,c,l,u,p,d,f,m){m.log("启用登录控制器"),e.quickUser={phoneNumber:"",validateCode:""},e.testLogin=function(){d.postLogin({account:"15917436116",password:"123456"}).then(function(e){switch(m.log(e.status),e.status){case"0":f.showTexts("账号或密码错误");break;case"1":User=e.userInfo,u.set("User",JSON.stringify(User)),o.closeLoginModal(),o.changePage(o.changeState,!0)}var t=u.get("User");m.log(t)})},e.test2Login=function(){d.postLogin({account:"377210718@qq.com",password:"yf123456"}).then(function(e){switch(m.log(e.status),e.status){case"0":f.showTexts("账号或密码错误");break;case"1":User=e.userInfo,u.set("User",JSON.stringify(User)),o.closeLoginModal(),o.changePage(o.changeState,!0)}var t=u.get("User");m.log(t)})},e.loginTitile="手机号登录",e.login=function(e){if("undefined"==typeof e||!e.account)return f.showTexts("请输入账号"),!1;var t=/1[3|5|7|8|][0-9]{9}/,n=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;return t.test(e.account)||n.test(e.account)?"undefined"!=typeof e&&e.password?void d.postLogin(e).then(function(e){switch(m.log(e.status),e.status){case"0":f.showTexts("账号或密码错误");break;case"1":User=e.userInfo,u.set("User",JSON.stringify(User)),o.closeLoginModal(),o.changePage(o.changeState,!0)}var t=u.get("User");m.log(t)}):(f.showTexts("请输入密码"),!1):(f.showTexts("请输入正确的账号"),!1)},e.isDisabled=!1,e.verTxt="获取验证码";var g=60;e.ajaxSendValidate=function(o){if(!o)return f.showTexts("请输入手机号码"),!1;var t=/1[3|5|7|8|][0-9]{9}/;if(!t.test(o))return f.showTexts("请输入有效的手机号码"),!1;e.isDisabled=!0,e.verTxt="60s";var n=a(function(){g>0?(g--,e.verTxt=g+"s"):(e.isDisabled=!1,e.verTxt="获取验证码",a.cancel(n))},1e3);d.postPhoneCode({phoneNumber:o}).then(function(e){switch(m.log(e.status),e.status){case"0":f.showTexts("获取手机验证码失败");break;case"1":f.showTexts("成功获取手机验证码")}})},e.quickLogin=function(t){return"undefined"!=typeof t&&t.phoneNumber?"undefined"!=typeof t&&t.validateCode?void d.postQuickLogin(t).then(function(n){switch(m.log(n.status),n.status){case"0":f.showTexts("账号或密码错误"),c(function(){e.quickUser={phoneNumber:t.phoneNumber,validateCode:""},jQuery(".phoneCode").focus(),jQuery(".phoneCode").val(""),m.log(e.quickUser)},1500);break;case"1":User=n.userInfo,u.set("User",JSON.stringify(User)),o.closeLoginModal(),o.changePage(o.changeState,!0)}}):(f.showTexts("请输入验证码"),!1):(f.showTexts("请输入手机号码"),!1)},e.showAlert=function(e){t.alert({title:"输入错误",template:e})},e.slideChangefn=function(e){s.slide(e,300)},e.loginslideChange=function(o){switch(o){case 0:e.loginTitile="手机号登录";break;case 1:e.loginTitile="密码登录"}},s.enableSlide(!1)}]).controller("IndexCtrl",["$scope","$rootScope","localStorageService","$state","$ionicModal","$ionicSlideBoxDelegate","$timeout","IonicService","TabService","Con",function(e,o,t,n,r,i,s,a,c,l){e.badges={message:0},e.tabs=c.getTabs(),o.UserInfo=JSON.parse(t.get("User")),o.loginOut=function(){l.log("退出"),t.remove("User"),location.reload(!0)}}]).controller("TabsCtrl",["$scope","$rootScope","localStorageService","$state","$ionicModal","$ionicSlideBoxDelegate","$timeout","IonicService","TabService","WechatApi","Con",function(e,o,t,n,r,i,s,a,c,l,u){o.$on("$ionicView.beforeEnter",function(){var e=n.current.name;"tab.homeDetail"===e?o.hideTabs=!0:o.hideTabs=!1}),r.fromTemplateUrl("templates/login.html",{scope:e,animation:"slide-in-up"}).then(function(o){e.loginmodal=o}),o.openLoginModal=function(){o.UserInfo=JSON.parse(t.get("User")),o.UserInfo?alert("你已经登陆"):e.loginmodal.show()},o.closeLoginModal=function(t){!t||"tab.star"!=o.changeState&&"tab.user"!=o.changeState||n.go("tab.home"),e.loginmodal.hide()},o.changePage=function(e,r){o.changeState=e,o.UserInfo=JSON.parse(t.get("User")),o.UserInfo?"tab.user"!=o.changeState&&"tab.star"!=o.changeState||!r?(u.log("不重载"),n.go(e)):(u.log("重载"),n.go(e),s(function(){location.reload(!0)},200)):o.openLoginModal()},l.f_wxShare()}]),angular.module("IonicClub.services",[]).service("IonicService",["$http","$q","ConfigService",function(e,o,t){return{postLogin:function(t){var n=o.defer(),r="http://test.upalapp.com/mobileplatform/admin/ajaxUserLogin";return e({method:"POST",url:r,headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){var o=[];for(var t in e)o.push(encodeURIComponent(t)+"="+encodeURIComponent(e[t]));return o.join("&")},data:t}).success(function(e,o,t,r){n.resolve(e)}),n.promise},postPhoneCode:function(t){var n=o.defer(),r="http://test.upalapp.com/mobileplatform/admin/ajaxSendValidate";return e({method:"POST",url:r,headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){var o=[];for(var t in e)o.push(encodeURIComponent(t)+"="+encodeURIComponent(e[t]));return o.join("&")},data:t}).success(function(e,o,t,r){n.resolve(e)}),n.promise},postQuickLogin:function(t){var n=o.defer(),r="http://test.upalapp.com/mobileplatform/admin/ajaxPhoneLogin";return e({method:"POST",url:r,headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){var o=[];for(var t in e)o.push(encodeURIComponent(t)+"="+encodeURIComponent(e[t]));return o.join("&")},data:t}).success(function(e,o,t,r){n.resolve(e)}),n.promise},getStorys:function(t){var n=o.defer(),r="http://test.upalapp.com/mobileplatform/moblie/story/ajaxGetStotyList";return e({method:"GET",url:r,headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){var o=[];for(var t in e)o.push(encodeURIComponent(t)+"="+encodeURIComponent(e[t]));return o.join("&")},params:t}).success(function(e,o,t,r){n.resolve(e)}),n.promise},getHomeStorys:function(t){var n=o.defer(),r="http://test.upalapp.com/mobileplatform/moblie/story/ajaxGetHomePageStorysList";return e({method:"GET",url:r,headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){var o=[];for(var t in e)o.push(encodeURIComponent(t)+"="+encodeURIComponent(e[t]));return o.join("&")},params:t}).success(function(e,o,t,r){n.resolve(e)}),n.promise},getCollectStorys:function(t){var n=o.defer(),r="http://test.upalapp.com/mobileplatform/moblie/story/ajaxGetFavoriteStorysList";return e({method:"GET",url:r,headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){var o=[];for(var t in e)o.push(encodeURIComponent(t)+"="+encodeURIComponent(e[t]));return o.join("&")},params:t}).success(function(e,o,t,r){n.resolve(e)}),n.promise},postCollectStory:function(t){var n=o.defer(),r="http://test.upalapp.com/mobileplatform/moblie/story/addUserFavorite";return e({method:"POST",url:r,headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){var o=[];for(var t in e)o.push(encodeURIComponent(t)+"="+encodeURIComponent(e[t]));return o.join("&")},data:t}).success(function(e,o,t,r){n.resolve(e)}),n.promise},postShareStory:function(t){var n=o.defer(),r="http://test.upalapp.com/mobileplatform/moblie/story/addUserShare";return e({method:"POST",url:r,headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){var o=[];for(var t in e)o.push(encodeURIComponent(t)+"="+encodeURIComponent(e[t]));return o.join("&")},data:t}).success(function(e,o,t,r){n.resolve(e)}),n.promise}}}]).service("ConfigService",[function(){var e="http://test.upalapp.com/",o={getHost:function(){return e}};return o}]).service("TabService",function(){var e=[{value:"share",label:"轻故事"},{value:"ask",label:"首页"},{value:"job",label:"关于"},{value:"bb",label:"吐槽"}],o={getTabs:function(){return e}};return o}).service("MsgBox",["$timeout",function(e){var o={showTexts:function(o,t){var n=t||1e3;angular.element(document.body).append('<div id="msgbox" ><span>'+o+"</span></div>"),e(function(){angular.element(document.querySelector("#msgbox")).addClass("msgboxani"),e(function(){angular.element(document.querySelector("#msgbox")).remove()},1e3)},n)}};return o}]).service("WechatApi",["$rootScope","$http",function(e,o){e.upal_share={title:"随身看的轻故事H5",desc:" 想浏览更多精彩故事？客官请点这里。",share_link:"http://www.upalapp.com/app/2016070401/index.html",imgUrl:"http://www.upalapp.com/app/2016070401/img/p01.png",currentUrl:location.href};var t={f_wxShare:function(){jQuery(function(){jQuery.ajax({type:"get",async:!1,url:"http://vip.upalapp.com/weixin/GetSignatureJson.do",data:{url:e.upal_share.currentUrl},dataType:"jsonp",jsonp:"callbackparam",success:function(e){var o=e.nonceStr,n=e.signature,r=e.timestamp;wx.config({debug:!1,appId:"wxbca4b4a3e2f790aa",timestamp:r,nonceStr:o,signature:n,jsApiList:["onMenuShareTimeline","onMenuShareAppMessage"]}),t.f_wxReady()},error:function(){}})})},f_wxReady:function(){wx.ready(function(){wx.onMenuShareAppMessage({title:e.upal_share.title,desc:e.upal_share.desc,link:e.upal_share.share_link,imgUrl:e.upal_share.imgUrl,success:function(){t.suc_callback()},cancel:function(){}}),wx.onMenuShareTimeline({title:e.upal_share.desc,link:e.upal_share.share_link,imgUrl:e.upal_share.imgUrl,success:function(){t.suc_callback()},cancel:function(){}})})},suc_callback:function(){e.shareStory()}};return t}]).service("Con",["$timeout",function(e){var o={log:function(e){}};return o}]),angular.module("IonicClub.filters",[]).filter("tabName",["TabService",function(e){var o=e.getTabs();return function(e){for(var t in o)if(o[t].value===e)return o[t].label}}]).filter("link",["$sce",function(e){return function(o){if("string"==typeof o){var t=/href="\/user\/([\S]+)"/gi,n=/src="\/\/([\S]+)"/gi,r=/href="((?!#\/user\/)[\S]+)"/gi;return e.trustAsHtml(o.replace(t,'href="#/user/$1"').replace(n,'src="https://$1"').replace(r,"onClick=\"window.open('$1', '_blank', 'location=yes')\""))}return o}}]).filter("protocol",function(){return function(e){return/^\/\//gi.test(e)?"https:"+e:e}}).filter("avatarFilter",function(){return function(e){return e&&(e=e.replace("https://avatars.githubusercontent.com","http://7xj5bc.com1.z0.glb.clouddn.com"),e+="&imageView2/2/w/120"),e}}),angular.module("IonicClub.directives",[]).directive("lazyScroll",["$rootScope","$timeout",function(e,o){return{restrict:"A",link:function(t,n){var r=0;t.invoke=function(){e.$broadcast("lazyScrollEvent")},n.bind("scroll",function(){o.cancel(r),r=o(t.invoke,0)})}}}]).directive("lazySrc",["$document","$timeout",function(e,o){return{restrict:"A",link:function(t,n,r){function i(){var o=e[0].documentElement.clientHeight,t=e[0].documentElement.clientWidth,r=n[0].getBoundingClientRect();return r.top>=0&&r.bottom<=o&&r.left>=0&&r.right<=t}var s=t.$on("lazyScrollEvent",function(){i()&&(n[0].src=r.lazySrc,s())});n.on("$destroy",function(){s()}),o(function(){i()&&(n[0].src=r.lazySrc,s())},500)}}}]),angular.module("IonicClub.pluginServices",["ngCordova"]).service("NetworkService",["$q","$cordovaNetwork",function(e,o){return{getNetworkType:function(){var t=e.defer();return document.addEventListener("deviceready",function(){t.resolve(o.getNetwork())},!1),t.promise},isOnline:function(){var t=e.defer();return document.addEventListener("deviceready",function(){t.resolve(o.isOnline())},!1),t.promise}}}]).service("DeviceService",["$q","$cordovaDevice",function(e,o){return{getDeviceInfo:function(){var t=e.defer();return document.addEventListener("deviceready",function(){t.resolve("设备名称:"+o.getModel()+";运行环境:"+o.getPlatform()+" "+o.getVersion())},!1),t.promise}}}]).service("ToastService",["$cordovaToast",function(e){return{showShortTop:function(o){e.showShortTop(o)},showShortCenter:function(o){e.showShortCenter(o)},showShortBottom:function(o){e.showShortBottom(o)},showLongTop:function(o){e.showLongTop(o)},showLongCenter:function(o){e.showLongCenter(o)},showLongBottom:function(o){e.showLongBottom(o)}}}]).service("SplashscreenService",["$cordovaSplashscreen",function(e){return{hide:function(){e.hide()},show:function(){e.show()}}}]).service("UmengService",["$q","$window",function(e,o){
return{init:function(){var t=e.defer();return o.plugins.umengAnalyticsPlugin.init(),t.resolve(null),t.promise}}}]).service("AppVersionService",["$q","$cordovaAppVersion",function(e,o){return{getVersionNumber:function(){var t=e.defer();return o.getVersionNumber().then(function(e){t.resolve(e)}),t.promise},getVersionCode:function(){var t=e.defer();return o.getVersionCode().then(function(e){t.resolve(e)}),t.promise}}}]).service("ShareService",["$q","$cordovaSocialSharing",function(e,o){return{share:function(e){o.share(e.message,e.subject,null,e.link)}}}]);