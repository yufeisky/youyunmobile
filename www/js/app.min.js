angular.module("IonicClub",["ionic","IonicClub.router","IonicClub.controllers","IonicClub.services","IonicClub.filters","IonicClub.directives","IonicClub.pluginServices","ngCordova","LocalStorageModule","pasvaz.bindonce","angularMoment"]).run(["$ionicPlatform","$rootScope","$state","$timeout","$ionicHistory","$cordovaAppVersion","$ionicPopup","$ionicLoading","$cordovaFileTransfer","$cordovaFile","$cordovaFileOpener2","$cordovaProgress","ToastService","SplashscreenService","UmengService","amMoment",function(e,o,t,n,r,i,s,c,a,l,u,p,d,f,g,v){e.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),window.StatusBar&&StatusBar.styleDefault(),g.init(),f.hide(),v.changeLocale("zh-cn")}),e.registerBackButtonAction(function(e){return t.includes("tab.topics")?o.backButtonPressedOnceToExit?(window.plugins.umengAnalyticsPlugin.onKillProcess(),ionic.Platform.exitApp()):(o.backButtonPressedOnceToExit=!0,d.showShortTop("再按一次退出系统"),setTimeout(function(){o.backButtonPressedOnceToExit=!1},2e3)):t.includes("tab.account")||t.includes("tab.login")?t.go("tab.topics"):r.backView()?r.goBack():(o.backButtonPressedOnceToExit&&(window.plugins.umengAnalyticsPlugin.onKillProcess(),ionic.Platform.exitApp()),o.backButtonPressedOnceToExit=!0,d.showShortTop("再按一次退出系统"),setTimeout(function(){o.backButtonPressedOnceToExit=!1},2e3)),e.preventDefault(),!1},101)}]).config(["$ionicConfigProvider","localStorageServiceProvider",function(e,o){o.setPrefix("ZxjIonicClub"),e.tabs.style("standard"),e.tabs.position("bottom"),e.navBar.alignTitle("center"),e.backButton.icon("ion-ios-arrow-thin-left"),e.views.transition("no"),Date.prototype.format=function(e){var o={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var t in o)new RegExp("("+t+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?o[t]:("00"+o[t]).substr((""+o[t]).length)));return e}}]),angular.module("IonicClub.router",[]).config(["$provide","$stateProvider","$urlRouterProvider",function(e,o,t){o.state("tab",{url:"/tab","abstract":!0,templateUrl:"templates/tabs.html"}).state("tab.home",{url:"/home",views:{home:{templateUrl:"templates/home.html",controller:"homeCtrl"}}}).state("tab.homeDetail",{url:"/homeDetail",views:{home:{templateUrl:"templates/homeDetail.html",controller:"homeCtrl"}}}).state("tab.star",{url:"/star",views:{star:{templateUrl:"templates/star.html",controller:"starCtrl"}}}).state("tab.user",{url:"/user",views:{user:{templateUrl:"templates/user.html",controller:"userCtrl"}},resolve:{validater:["$location","localStorageService",function(e,o){var t=o.get("User");t||e.path("/login")}]}}).state("login",{url:"/login",templateUrl:"templates/login.html",controller:"loginCtrl",resolve:{validater:["$location","localStorageService",function(e,o){var t=o.get("User");t&&e.path("/tab/user")}]}}),t.otherwise("tab/home")}]),angular.module("IonicClub.controllers",[]).controller("userCtrl",["$scope","$stateParams","$state","$ionicLoading","$ionicModal","localStorageService","IonicService","TabService",function(e,o,t,n,r,i,s,c){console.log("个人中心控制器已加载");var a={};e.storys=[],e.offLineStorys=[],e.more=!0;var l=JSON.parse(i.get("User"));console.log(l),l?(console.log("已登录"),a={userToken:l.token,userId:l.id}):t.go("login"),e.navs=[{title:"已上线",order:0,storyStatus:"1",pageNum:0},{title:"未上线",order:1,storyStatus:"0",pageNum:0},{title:"我的收藏",order:2,storyStatus:"3",pageNum:0},{title:"我的动态",order:3,storyStatus:"4",pageNum:0}],e.isActiveTab=function(o){return e.currentTab==o},e.loadMore=function(o,t){e.more=!0;try{switch(e.currentTab=o,e.myActiveSlide=o,a.storyStatus=e.navs[o].storyStatus,e.navs[o].pageNum=e.navs[o].pageNum+1,a.pageNum=e.navs[o].pageNum,console.log(a.storyStatus),a.storyStatus){case"1":s.getStorys(a).then(function(o){o.storys[0]||(e.more=!1),o.storys&&(1==a.pageNum?e.storys=o.storys:angular.forEach(o.storys,function(o){e.storys.push(o)}),e.$broadcast("scroll.infiniteScrollComplete"))});break;case"0":s.getStorys(a).then(function(o){o.storys[0]||(e.more=!1),o.storys&&(1==a.pageNum?e.offLineStorys=o.storys:angular.forEach(o.storys,function(o){e.offLineStorys.push(o)}),e.$broadcast("scroll.infiniteScrollComplete"))});break;case"3":console.log("我的收藏");break;case"4":console.log("我的动态")}}catch(n){e.more=!1}},e.myActiveSlide="0"}]).controller("userstoryCtrl",["$scope","$stateParams","$ionicLoading","$ionicScrollDelegate","localStorageService","ShareService","IonicService",function(e,o,t,n,r,i,s){console.log("未上线控制器")}]).controller("homeCtrl",["$scope","$stateParams","$ionicLoading","$ionicScrollDelegate","localStorageService","ShareService","IonicService",function(e,o,t,n,r,i,s){}]).controller("starCtrl",["$scope","$stateParams","$ionicLoading","$ionicScrollDelegate","localStorageService","ShareService","IonicService",function(e,o,t,n,r,i,s){}]).controller("loginCtrl",["$scope","$ionicPopup","$ionicHistory","$state","$cordovaBarcodeScanner","localStorageService","AppVersionService","IonicService",function(e,o,t,n,r,i,s,c){console.log("启用登录控制器"),e.login=function(o){return console.log(o),"undefined"!=typeof o&&o.account?"undefined"!=typeof o&&o.password?void c.postLogin(o).then(function(o){switch(console.log(o.status),o.status){case"0":e.showAlert("账号或密码错误");break;case"1":User=o.userInfo,i.set("User",JSON.stringify(User)),n.go("tab.user")}var t=i.get("User");console.log(t)}):(e.showAlert("请输入密码"),!1):(e.showAlert("请输入账号"),!1)},e.showAlert=function(e){o.alert({title:"Warning Message",template:e})}}]).controller("AccountCtrl",["$scope","$ionicHistory","$state","$ionicModal","$ionicLoading","localStorageService","AppVersionService","IonicService",function(e,o,t,n,r,i,s,c){e.deCollectData={accesstoken:"",topic_id:""};var a=JSON.parse(i.get("User"));a?(e.deCollectData.accesstoken=a.accesstoken,c.getUserByName(a.loginname).then(function(o){e.Account=o.data}),c.getMessages(a.accesstoken).then(function(o){e.messages=o.data})):t.go("tab.login"),e.deCollect=function(o){e.deCollectData.topic_id=o,c.postTopicDeCollect(e.deCollectData).then(function(e){e.success&&r.show({template:"取消收藏成功",duration:500})})},n.fromTemplateUrl("templates/Area/favorites.html",{id:"1",scope:e}).then(function(o){e.oModal1=o}),n.fromTemplateUrl("templates/Area/messages.html",{id:"2",scope:e}).then(function(o){e.oModal2=o}),n.fromTemplateUrl("templates/Area/createTopics.html",{id:"3",scope:e}).then(function(o){e.oModal3=o}),n.fromTemplateUrl("templates/Area/joinTopics.html",{id:"4",scope:e}).then(function(o){e.oModal4=o}),e.openModal=function(o){switch(o){case 1:e.oModal1.show();break;case 2:e.oModal2.show().then(function(){c.postMessageMark_all(a.accesstoken).then(function(o){o.success&&(e.badges.message=0)})});break;case 3:e.oModal3.show();break;case 4:e.oModal4.show()}},e.closeModal=function(o){switch(o){case 1:e.oModal1.hide();break;case 2:e.oModal2.hide();break;case 3:e.oModal3.hide();break;case 4:e.oModal4.hide()}}}]).controller("AccountDetailCtrl",["$scope","$ionicHistory","$state","localStorageService","IonicService",function(e,o,t,n,r){var i=JSON.parse(n.get("User"));i&&r.getUserByName(i.loginname).then(function(o){e.Account=o.data}),e.loginOut=function(){n.remove("User"),o.nextViewOptions({disableAnimate:!0,disableBack:!0}),t.go("tab.login")}}]).controller("IndexCtrl",["$scope","localStorageService","$state","IonicService","TabService",function(e,o,t,n,r){e.badges={message:0},e.tabs=r.getTabs();var i=JSON.parse(o.get("User"));i&&n.getMessageCount(i.token).then(function(o){e.badges.message=o.data}),e.loginOut=function(){console.log("退出"),o.remove("User"),t.go("login")}}]),angular.module("IonicClub.services",[]).service("IonicService",["$http","$q","ConfigService",function(e,o,t){return{postLogin:function(t){var n=o.defer(),r="http://test.upalapp.com/mobileplatform/admin/ajaxUserLogin";return e({method:"POST",url:r,headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){var o=[];for(var t in e)o.push(encodeURIComponent(t)+"="+encodeURIComponent(e[t]));return o.join("&")},data:t}).success(function(e,o,t,r){n.resolve(e)}),n.promise},getStorys:function(t){var n=o.defer(),r="http://test.upalapp.com/mobileplatform/moblie/story/ajaxGetStotyList";return e({method:"GET",url:r,headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){var o=[];for(var t in e)o.push(encodeURIComponent(t)+"="+encodeURIComponent(e[t]));return o.join("&")},params:t}).success(function(e,o,t,r){n.resolve(e)}),n.promise},getTopics:function(n){var r=o.defer(),i=t.getHost()+"/api/v1/topics";return e({method:"GET",url:i,params:n}).success(function(e,o,t,n){r.resolve(e)}),r.promise},getTopicById:function(n){var r=o.defer(),i=t.getHost()+"/api/v1/topic/"+n;return e.get(i).success(function(e){r.resolve(e)}),r.promise},postTopic:function(n){var r=o.defer(),i=t.getHost()+"/api/v1/topics";return e({method:"POST",url:i,headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){var o=[];for(var t in e)o.push(encodeURIComponent(t)+"="+encodeURIComponent(e[t]));return o.join("&")},data:n}).success(function(e,o,t,n){r.resolve(e)}),r.promise},postTopicCollect:function(n){var r=o.defer(),i=t.getHost()+"/api/v1/topic/collect";return e({method:"POST",url:i,headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){var o=[];for(var t in e)o.push(encodeURIComponent(t)+"="+encodeURIComponent(e[t]));return o.join("&")},data:n}).success(function(e,o,t,n){r.resolve(e)}),r.promise},postTopicDeCollect:function(n){var r=o.defer(),i=t.getHost()+"/api/v1/topic/de_collect";return e({method:"POST",url:i,headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){var o=[];for(var t in e)o.push(encodeURIComponent(t)+"="+encodeURIComponent(e[t]));return o.join("&")},data:n}).success(function(e,o,t,n){r.resolve(e)}),r.promise},postReplie:function(n,r){var i=o.defer(),s=t.getHost()+"/api/v1/topic/"+n+"/replies";return e({method:"POST",url:s,headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){var o=[];for(var t in e)o.push(encodeURIComponent(t)+"="+encodeURIComponent(e[t]));return o.join("&")},data:r}).success(function(e,o,t,n){i.resolve(e)}),i.promise},postReplieUps:function(n,r){var i=o.defer(),s=t.getHost()+"/api/v1/reply/"+n+"/ups?accesstoken="+r;return e({method:"POST",url:s}).success(function(e,o,t,n){i.resolve(e)}),i.promise},getUserByName:function(n){var r=o.defer(),i=t.getHost()+"/api/v1/user/"+n;return e.get(i).success(function(e){r.resolve(e)}),r.promise},postUserLogin:function(n){var r=o.defer(),i=t.getHost()+"/api/v1/accesstoken?accesstoken="+n;return e({method:"POST",url:i}).success(function(e,o,t,n){r.resolve(e)}),r.promise},getMessageCount:function(n){var r=o.defer(),i=t.getHost()+"/api/v1/message/count?accesstoken="+n;return e.get(i).success(function(e){r.resolve(e)}),r.promise},getMessages:function(n){var r=o.defer(),i=t.getHost()+"/api/v1/messages?accesstoken="+n;return e.get(i).success(function(e){r.resolve(e)}),r.promise},postMessageMark_all:function(n){var r=o.defer(),i=t.getHost()+"/api/v1/message/mark_all?accesstoken="+n;return e({method:"POST",url:i}).success(function(e,o,t,n){r.resolve(e)}),r.promise}}}]).service("ConfigService",[function(){var e="http://ionichina.com",o={getHost:function(){return e}};return o}]).service("TabService",function(){var e=[{value:"share",label:"分享"},{value:"ask",label:"问答"},{value:"job",label:"招聘"},{value:"bb",label:"吐槽"}],o={getTabs:function(){return e}};return o}),angular.module("IonicClub.filters",[]).filter("tabName",["TabService",function(e){var o=e.getTabs();return function(e){for(var t in o)if(o[t].value===e)return o[t].label}}]).filter("link",["$sce",function(e){return function(o){if("string"==typeof o){var t=/href="\/user\/([\S]+)"/gi,n=/src="\/\/([\S]+)"/gi,r=/href="((?!#\/user\/)[\S]+)"/gi;return e.trustAsHtml(o.replace(t,'href="#/user/$1"').replace(n,'src="https://$1"').replace(r,"onClick=\"window.open('$1', '_blank', 'location=yes')\""))}return o}}]).filter("protocol",function(){return function(e){return/^\/\//gi.test(e)?"https:"+e:e}}).filter("avatarFilter",function(){return function(e){return e&&(e=e.replace("https://avatars.githubusercontent.com","http://7xj5bc.com1.z0.glb.clouddn.com"),e+="&imageView2/2/w/120"),e}}),angular.module("IonicClub.directives",[]).directive("lazyScroll",["$rootScope","$timeout",function(e,o){return{restrict:"A",link:function(t,n){var r=0;t.invoke=function(){e.$broadcast("lazyScrollEvent")},n.bind("scroll",function(){o.cancel(r),r=o(t.invoke,0)})}}}]).directive("lazySrc",["$document","$timeout",function(e,o){return{restrict:"A",link:function(t,n,r){function i(){var o=e[0].documentElement.clientHeight,t=e[0].documentElement.clientWidth,r=n[0].getBoundingClientRect();return r.top>=0&&r.bottom<=o&&r.left>=0&&r.right<=t}var s=t.$on("lazyScrollEvent",function(){i()&&(n[0].src=r.lazySrc,s())});n.on("$destroy",function(){s()}),o(function(){i()&&(n[0].src=r.lazySrc,s())},500)}}}]),angular.module("IonicClub.pluginServices",["ngCordova"]).service("NetworkService",["$q","$cordovaNetwork",function(e,o){return{getNetworkType:function(){var t=e.defer();return document.addEventListener("deviceready",function(){t.resolve(o.getNetwork())},!1),t.promise},isOnline:function(){var t=e.defer();return document.addEventListener("deviceready",function(){t.resolve(o.isOnline())},!1),t.promise}}}]).service("DeviceService",["$q","$cordovaDevice",function(e,o){return{getDeviceInfo:function(){var t=e.defer();return document.addEventListener("deviceready",function(){t.resolve("设备名称:"+o.getModel()+";运行环境:"+o.getPlatform()+" "+o.getVersion())},!1),t.promise}}}]).service("ToastService",["$cordovaToast",function(e){return{showShortTop:function(o){e.showShortTop(o)},showShortCenter:function(o){e.showShortCenter(o)},showShortBottom:function(o){e.showShortBottom(o)},showLongTop:function(o){e.showLongTop(o)},showLongCenter:function(o){e.showLongCenter(o)},showLongBottom:function(o){e.showLongBottom(o)}}}]).service("SplashscreenService",["$cordovaSplashscreen",function(e){return{hide:function(){e.hide()},show:function(){e.show()}}}]).service("UmengService",["$q","$window",function(e,o){return{init:function(){var t=e.defer();return o.plugins.umengAnalyticsPlugin.init(),t.resolve(null),t.promise}}}]).service("AppVersionService",["$q","$cordovaAppVersion",function(e,o){return{getVersionNumber:function(){var t=e.defer();return o.getVersionNumber().then(function(e){t.resolve(e)}),t.promise},getVersionCode:function(){var t=e.defer();return o.getVersionCode().then(function(e){t.resolve(e)}),t.promise}}}]).service("ShareService",["$q","$cordovaSocialSharing",function(e,o){return{share:function(e){o.share(e.message,e.subject,null,e.link)}}}]);