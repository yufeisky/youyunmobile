angular.module("IonicClub",["ionic","IonicClub.router","IonicClub.controllers","IonicClub.services","IonicClub.filters","IonicClub.directives","IonicClub.pluginServices","ngCordova","LocalStorageModule","pasvaz.bindonce","angularMoment"]).run(["$ionicPlatform","$rootScope","$state","$timeout","$ionicHistory","$cordovaAppVersion","$ionicPopup","$ionicLoading","$cordovaFileTransfer","$cordovaFile","$cordovaFileOpener2","$cordovaProgress","ToastService","SplashscreenService","UmengService","amMoment",function(e,o,t,n,r,i,s,a,c,l,u,p,d,g,m,f){e.ready(function(){window.cordova&&window.cordova.plugins.Keyboard&&cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),window.StatusBar&&StatusBar.styleDefault(),m.init(),g.hide(),f.changeLocale("zh-cn")}),e.registerBackButtonAction(function(e){return t.includes("tab.topics")?o.backButtonPressedOnceToExit?(window.plugins.umengAnalyticsPlugin.onKillProcess(),ionic.Platform.exitApp()):(o.backButtonPressedOnceToExit=!0,d.showShortTop("再按一次退出系统"),setTimeout(function(){o.backButtonPressedOnceToExit=!1},2e3)):t.includes("tab.account")||t.includes("tab.login")?t.go("tab.topics"):r.backView()?r.goBack():(o.backButtonPressedOnceToExit&&(window.plugins.umengAnalyticsPlugin.onKillProcess(),ionic.Platform.exitApp()),o.backButtonPressedOnceToExit=!0,d.showShortTop("再按一次退出系统"),setTimeout(function(){o.backButtonPressedOnceToExit=!1},2e3)),e.preventDefault(),!1},101)}]).config(["$ionicConfigProvider","localStorageServiceProvider",function(e,o){o.setPrefix("ZxjIonicClub"),e.tabs.style("standard"),e.tabs.position("bottom"),e.navBar.alignTitle("center"),e.backButton.icon("ion-ios-arrow-thin-left"),e.views.transition("no"),Date.prototype.format=function(e){var o={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var t in o)new RegExp("("+t+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?o[t]:("00"+o[t]).substr((""+o[t]).length)));return e}}]),angular.module("IonicClub.router",[]).config(["$provide","$stateProvider","$urlRouterProvider",function(e,o,t){o.state("tab",{url:"/tab","abstract":!0,templateUrl:"templates/tabs.html"}).state("tab.home",{url:"/home",views:{home:{templateUrl:"templates/home.html",controller:"homeCtrl"}}}).state("tab.homeDetail",{url:"/homeDetail:pubUrl",views:{home:{templateUrl:"templates/homeDetail.html",controller:"homeDetailCtrl"}}}).state("tab.star",{url:"/star",views:{star:{templateUrl:"templates/star.html",controller:"starCtrl"}}}).state("tab.user",{url:"/user",views:{user:{templateUrl:"templates/user.html",controller:"userCtrl"}}}),t.otherwise("tab/home")}]),angular.module("IonicClub.controllers",[]).controller("userCtrl",["$scope","$rootScope","$stateParams","$state","$ionicLoading","$ionicPopup","$ionicHistory","$ionicModal","$timeout","localStorageService","IonicService","TabService",function(e,o,t,n,r,i,s,a,c,l,u,p){console.log("个人中心控制器已加载");var d={};e.storys=[],e.offLineStorys=[];var g=JSON.parse(l.get("User"));console.log(g),g?(e.more=!0,console.log("已登录"),d={userToken:g.token,userId:g.id},e.navs=[{title:"已上线",order:0,storyStatus:"1",pageNum:0},{title:"未上线",order:1,storyStatus:"0",pageNum:0},{title:"我的收藏",order:2,storyStatus:"3",pageNum:0},{title:"我的动态",order:3,storyStatus:"4",pageNum:0}],e.isActiveTab=function(o){return e.currentTab==o},e.loadMore=function(o,t){e.more=!0;try{switch(e.currentTab=o,e.myActiveSlide=o,d.storyStatus=e.navs[o].storyStatus,e.navs[o].pageNum=e.navs[o].pageNum+1,d.pageNum=e.navs[o].pageNum,console.log(d.storyStatus),d.storyStatus){case"1":u.getStorys(d).then(function(o){o.storys[0]||(e.more=!1),o.storys&&(1==d.pageNum?e.storys=o.storys:angular.forEach(o.storys,function(o){e.storys.push(o)}),e.$broadcast("scroll.infiniteScrollComplete"))});break;case"0":u.getStorys(d).then(function(o){o.storys[0]||(e.more=!1),o.storys&&(1==d.pageNum?e.offLineStorys=o.storys:angular.forEach(o.storys,function(o){e.offLineStorys.push(o)}),e.$broadcast("scroll.infiniteScrollComplete"))});break;case"3":console.log("我的收藏");break;case"4":console.log("我的动态")}}catch(n){e.more=!1}},e.myActiveSlide="0"):(console.log("未登录"),c(function(){o.changePage("tab.user")},100))}]).controller("homeDetailCtrl",["$scope","$rootScope","$sce","$stateParams","$ionicLoading","$ionicScrollDelegate","localStorageService","ShareService","IonicService",function(e,o,t,n,r,i,s,a,c){console.log("首页详情");var l=n.pubUrl;e.pubUrl=t.trustAsResourceUrl(l),e.storyShare=function(){console.log("点击触发")}}]).controller("homeCtrl",["$scope","$rootScope","$stateParams","$ionicLoading","$ionicScrollDelegate","localStorageService","ShareService","IonicService",function(e,o,t,n,r,i,s,a){e.storys=[[],[],[],[]],e.more=!0,e.navs=[{title:"推荐",order:0,storyStatus:"4",pageNum:0},{title:"品牌故事",order:1,storyStatus:"1",pageNum:0},{title:"热点资讯",order:2,storyStatus:"2",pageNum:0},{title:"生活故事",order:3,storyStatus:"3",pageNum:0}],e.isActiveTab=function(o){return e.currentTab==o};var c=JSON.parse(i.get("User"));c?postParams={userToken:c.token,userId:c.id}:postParams={userToken:"",userId:""};var l=angular.element(window)[0].innerWidth;e.img_w=.45*l*.9+"px",e.loadMore=function(o,t){e.more=!0;try{e.currentTab=o,e.myActiveSlide=o,postParams.storyType=e.navs[o].storyStatus,e.navs[o].pageNum=e.navs[o].pageNum+1,postParams.pageNum=e.navs[o].pageNum,console.log(postParams.storyType),a.getHomeStorys(postParams).then(function(o){o.storys[0]||(e.more=!1),o.storys&&(1==postParams.pageNum?e.storys[e.currentTab]=o.storys:angular.forEach(o.storys,function(o){e.storys[e.currentTab].push(o)}),e.$broadcast("scroll.infiniteScrollComplete"))})}catch(n){e.more=!1}},e.myActiveSlide="0"}]).controller("starCtrl",["$scope","$rootScope","$state","$stateParams","$ionicLoading","$ionicScrollDelegate","$ionicModal","$ionicHistory","$timeout","localStorageService","ShareService","IonicService",function(e,o,t,n,r,i,s,a,c,l,u,p){var d=JSON.parse(l.get("User"));console.log(d),d||c(function(){o.changePage("tab.star")},100)}]).controller("loginCtrl",["$scope","$rootScope","$ionicPopup","$ionicHistory","$state","$cordovaBarcodeScanner","$ionicSlideBoxDelegate","$interval","$ionicModal","localStorageService","AppVersionService","IonicService","MsgBox",function(e,o,t,n,r,i,s,a,c,l,u,p,d){console.log("启用登录控制器"),e.loginTitile="手机号登录",e.login=function(e){if("undefined"==typeof e||!e.account)return d.showTexts("请输入账号"),!1;var t=/1[3|5|7|8|][0-9]{9}/,n=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;return t.test(e.account)||n.test(e.account)?"undefined"!=typeof e&&e.password?void p.postLogin(e).then(function(e){switch(console.log(e.status),e.status){case"0":d.showTexts("账号或密码错误");break;case"1":User=e.userInfo,l.set("User",JSON.stringify(User)),o.closeLoginModal(),o.changePage(o.changeState,!0)}var t=l.get("User");console.log(t)}):(d.showTexts("请输入密码"),!1):(d.showTexts("请输入正确的账号"),!1)},e.isDisabled=!1,e.verTxt="获取验证码";var g=60;e.ajaxSendValidate=function(o){if(!o)return d.showTexts("请输入手机号码"),!1;var t=/1[3|5|7|8|][0-9]{9}/;if(!t.test(o))return d.showTexts("请输入有效的手机号码"),!1;e.isDisabled=!0,e.verTxt="60s";var n=a(function(){g>0?(g--,e.verTxt=g+"S"):(e.isDisabled=!1,e.verTxt="获取验证码",a.cancel(n))},1e3);p.postPhoneCode({phoneNumber:o}).then(function(e){switch(console.log(e.status),e.status){case"0":d.showTexts("获取手机验证码失败");break;case"1":d.showTexts("成功获取手机验证码")}})},e.quickLogin=function(e){return"undefined"!=typeof e&&e.phoneNumber?"undefined"!=typeof e&&e.validateCode?void p.postQuickLogin(e).then(function(e){switch(console.log(e.status),e.status){case"0":d.showTexts("账号或密码错误");break;case"1":User=e.userInfo,l.set("User",JSON.stringify(User)),o.closeLoginModal(),o.changePage(o.changeState,!0)}}):(d.showTexts("请输入验证码"),!1):(d.showTexts("请输入手机号码"),!1)},e.showAlert=function(e){t.alert({title:"输入错误",template:e})},e.slideChangefn=function(e){s.slide(e,300)},e.loginslideChange=function(o){switch(o){case 0:e.loginTitile="手机号登录";break;case 1:e.loginTitile="密码登录"}}}]).controller("IndexCtrl",["$scope","$rootScope","localStorageService","$state","$ionicModal","$ionicSlideBoxDelegate","$timeout","IonicService","TabService",function(e,o,t,n,r,i,s,a,c){e.badges={message:0},e.tabs=c.getTabs(),o.UserInfo=JSON.parse(t.get("User")),e.loginOut=function(){console.log("退出"),t.remove("User"),location.reload(!0)}}]).controller("TabsCtrl",["$scope","$rootScope","localStorageService","$state","$ionicModal","$ionicSlideBoxDelegate","$timeout","IonicService","TabService",function(e,o,t,n,r,i,s,a,c){o.$on("$ionicView.beforeEnter",function(){var e=n.current.name;"tab.homeDetail"===e?o.hideTabs=!0:o.hideTabs=!1}),r.fromTemplateUrl("templates/login.html",{scope:e,animation:"slide-in-up"}).then(function(o){e.loginmodal=o}),o.openLoginModal=function(){o.UserInfo=JSON.parse(t.get("User")),o.UserInfo?alert("你已经登陆"):e.loginmodal.show()},o.closeLoginModal=function(t){!t||"tab.star"!=o.changeState&&"tab.user"!=o.changeState||n.go("tab.home"),e.loginmodal.hide()},o.changePage=function(e,r){o.changeState=e,o.UserInfo=JSON.parse(t.get("User")),o.UserInfo?"tab.user"!=o.changeState&&"tab.star"!=o.changeState||!r?(console.log("不重载"),n.go(e)):(console.log("重载"),n.go(e),s(function(){location.reload(!0)},200)):o.openLoginModal()}}]),angular.module("IonicClub.services",[]).service("IonicService",["$http","$q","ConfigService",function(e,o,t){return{postLogin:function(t){var n=o.defer(),r="http://test.upalapp.com/mobileplatform/admin/ajaxUserLogin";return e({method:"POST",url:r,headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){var o=[];for(var t in e)o.push(encodeURIComponent(t)+"="+encodeURIComponent(e[t]));return o.join("&")},data:t}).success(function(e,o,t,r){n.resolve(e)}),n.promise},postPhoneCode:function(t){var n=o.defer(),r="http://test.upalapp.com/mobileplatform/admin/ajaxSendValidate";return e({method:"POST",url:r,headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){var o=[];for(var t in e)o.push(encodeURIComponent(t)+"="+encodeURIComponent(e[t]));return o.join("&")},data:t}).success(function(e,o,t,r){n.resolve(e)}),n.promise},postQuickLogin:function(t){var n=o.defer(),r="http://test.upalapp.com/mobileplatform/admin/ajaxPhoneLogin";return e({method:"POST",url:r,headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){var o=[];for(var t in e)o.push(encodeURIComponent(t)+"="+encodeURIComponent(e[t]));return o.join("&")},data:t}).success(function(e,o,t,r){n.resolve(e)}),n.promise},getStorys:function(t){var n=o.defer(),r="http://test.upalapp.com/mobileplatform/moblie/story/ajaxGetStotyList";return e({method:"GET",url:r,headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){var o=[];for(var t in e)o.push(encodeURIComponent(t)+"="+encodeURIComponent(e[t]));return o.join("&")},params:t}).success(function(e,o,t,r){n.resolve(e)}),n.promise},getHomeStorys:function(t){var n=o.defer(),r="http://test.upalapp.com/mobileplatform/moblie/story/ajaxGetHomePageStorysList";return e({method:"GET",url:r,headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){var o=[];for(var t in e)o.push(encodeURIComponent(t)+"="+encodeURIComponent(e[t]));return o.join("&")},params:t}).success(function(e,o,t,r){n.resolve(e)}),n.promise}}}]).service("ConfigService",[function(){var e="http://test.upalapp.com/",o={getHost:function(){return e}};return o}]).service("TabService",function(){var e=[{value:"share",label:"分享"},{value:"ask",label:"问答"},{value:"job",label:"招聘"},{value:"bb",label:"吐槽"}],o={getTabs:function(){return e}};return o}).service("MsgBox",["$timeout",function(e){var o={showTexts:function(o,t){var n=t||1e3;angular.element(document.body).append('<div id="msgbox" ><span>'+o+"</span></div>"),e(function(){angular.element(document.querySelector("#msgbox")).addClass("msgboxani"),e(function(){angular.element(document.querySelector("#msgbox")).remove()},1e3)},n)}};return o}]),angular.module("IonicClub.filters",[]).filter("tabName",["TabService",function(e){var o=e.getTabs();return function(e){for(var t in o)if(o[t].value===e)return o[t].label}}]).filter("link",["$sce",function(e){return function(o){if("string"==typeof o){var t=/href="\/user\/([\S]+)"/gi,n=/src="\/\/([\S]+)"/gi,r=/href="((?!#\/user\/)[\S]+)"/gi;return e.trustAsHtml(o.replace(t,'href="#/user/$1"').replace(n,'src="https://$1"').replace(r,"onClick=\"window.open('$1', '_blank', 'location=yes')\""))}return o}}]).filter("protocol",function(){return function(e){return/^\/\//gi.test(e)?"https:"+e:e}}).filter("avatarFilter",function(){return function(e){return e&&(e=e.replace("https://avatars.githubusercontent.com","http://7xj5bc.com1.z0.glb.clouddn.com"),e+="&imageView2/2/w/120"),e}}),angular.module("IonicClub.directives",[]).directive("lazyScroll",["$rootScope","$timeout",function(e,o){return{restrict:"A",link:function(t,n){var r=0;t.invoke=function(){e.$broadcast("lazyScrollEvent")},n.bind("scroll",function(){o.cancel(r),r=o(t.invoke,0)})}}}]).directive("lazySrc",["$document","$timeout",function(e,o){return{restrict:"A",link:function(t,n,r){function i(){var o=e[0].documentElement.clientHeight,t=e[0].documentElement.clientWidth,r=n[0].getBoundingClientRect();return r.top>=0&&r.bottom<=o&&r.left>=0&&r.right<=t}var s=t.$on("lazyScrollEvent",function(){i()&&(n[0].src=r.lazySrc,s())});n.on("$destroy",function(){s()}),o(function(){i()&&(n[0].src=r.lazySrc,s())},500)}}}]),angular.module("IonicClub.pluginServices",["ngCordova"]).service("NetworkService",["$q","$cordovaNetwork",function(e,o){return{getNetworkType:function(){var t=e.defer();return document.addEventListener("deviceready",function(){t.resolve(o.getNetwork())},!1),t.promise},isOnline:function(){var t=e.defer();return document.addEventListener("deviceready",function(){t.resolve(o.isOnline())},!1),t.promise}}}]).service("DeviceService",["$q","$cordovaDevice",function(e,o){return{getDeviceInfo:function(){var t=e.defer();return document.addEventListener("deviceready",function(){t.resolve("设备名称:"+o.getModel()+";运行环境:"+o.getPlatform()+" "+o.getVersion())},!1),t.promise}}}]).service("ToastService",["$cordovaToast",function(e){return{showShortTop:function(o){e.showShortTop(o)},showShortCenter:function(o){e.showShortCenter(o)},showShortBottom:function(o){e.showShortBottom(o)},showLongTop:function(o){e.showLongTop(o)},showLongCenter:function(o){e.showLongCenter(o)},showLongBottom:function(o){e.showLongBottom(o)}}}]).service("SplashscreenService",["$cordovaSplashscreen",function(e){return{hide:function(){e.hide()},show:function(){e.show()}}}]).service("UmengService",["$q","$window",function(e,o){return{init:function(){var t=e.defer();return o.plugins.umengAnalyticsPlugin.init(),t.resolve(null),t.promise}}}]).service("AppVersionService",["$q","$cordovaAppVersion",function(e,o){return{getVersionNumber:function(){var t=e.defer();return o.getVersionNumber().then(function(e){t.resolve(e)}),t.promise},getVersionCode:function(){var t=e.defer();return o.getVersionCode().then(function(e){t.resolve(e)}),t.promise}}}]).service("ShareService",["$q","$cordovaSocialSharing",function(e,o){return{share:function(e){o.share(e.message,e.subject,null,e.link)}}}]);